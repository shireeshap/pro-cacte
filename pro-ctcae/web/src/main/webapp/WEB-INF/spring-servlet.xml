<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:p="http://www.springframework.org/schema/p"
	   xmlns:context="http://www.springframework.org/schema/context"
	   xmlns:dwr="http://www.directwebremoting.org/schema/spring-dwr"
	   xsi:schemaLocation="
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
        http://www.directwebremoting.org/schema/spring-dwr
        http://www.directwebremoting.org/schema/spring-dwr-2.0.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context-2.5.xsd">

    <!--<bean id="messageSource" class="org.springframework.context.support.ResourceBundleMessageSource">-->
	<!--<property name="basename">-->
	<!--<value>message</value>-->
	<!--</property>-->
	<!--</bean>-->

	<bean id="messageSource" class="org.springframework.context.support.ReloadableResourceBundleMessageSource">
    <property name="basename">
        <value>/WEB-INF/message</value>
    </property>
    <property name="cacheSeconds" value="1"/>
    </bean>

    <bean id="simpleUrlHandlerMapping" class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
        <property name="order" value="1"/>

        <property name="mappings">
            <value>
                <!--/form/createForm=createFormController-->
				<!--/form/viewForm=viewFormController-->
            </value>
        </property>
        <property name="interceptors">
            <list>

                <!--<ref bean="loginCheckInterceptor"/>-->

				<ref bean="sectionInterceptor"/>
            </list>
        </property>

    </bean>

	<!--<bean id="tilesViewResolver" class="org.springframework.js.ajax.AjaxUrlBasedViewResolver">-->
	<!--<property name="requestContextAttribute" value="requestContext"/>-->
	<!--<property name="viewClass" value="org.springframework.js.ajax.tiles2.AjaxTilesView"/>-->
	<!--<property name="order" value="2"/>-->
	<!--</bean>-->

	<bean class="org.springframework.beans.factory.annotation.RequiredAnnotationBeanPostProcessor"/>

    <bean id="xmlViewResolver" class="org.springframework.web.servlet.view.XmlViewResolver" p:order="1">
        <property name="location">
            <value>/WEB-INF/special-views.xml</value>
        </property>
        </bean>

    <bean class="org.springframework.web.servlet.view.tiles2.TilesConfigurer">
        <property name="definitions">
            <list>
                <value>/WEB-INF/tiles-definitions.xml</value>
                <value>/WEB-INF/views/study/tiles-definitions.xml</value>
            </list>
        </property>
    </bean>
    <bean id="urlResolver" class="gov.nih.nci.cabig.ctms.tools.spring.BeanNameControllerUrlResolver"
		  p:servletName="pages"/>


    <bean id="irViewResolver" class="org.springframework.web.servlet.view.InternalResourceViewResolver"
		  p:viewClass="org.springframework.web.servlet.view.InternalResourceView"
		  p:prefix="/WEB-INF/views/" p:suffix=".jsp"/>

    <bean id="multipartResolver"
		  class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
        <!-- one of the properties available; the maximum file size in bytes -->
		<property name="maxUploadSize" value="10000000"/>
    </bean>

    <bean id="urlMapping" class="org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping" lazy-init="true">
        <property name="interceptors">
            <list>

                <!--<ref bean="loginCheckInterceptor"/>-->

				<ref bean="sectionInterceptor"/>
            </list>
        </property>
    </bean>

    <bean id="sectionInterceptor" class="gov.nih.nci.cabig.ctms.web.chrome.SectionInterceptor">
        <property name="sections">
            <list>
                <bean class="gov.nih.nci.cabig.ctms.web.chrome.Section" p:urlResolver-ref="urlResolver"
					  p:displayName="Form"
					  p:mainController="manageFormController" p:pathMapping="/form/**">
                    <property name="tasks">
                        <list>
                            <bean class="gov.nih.nci.cabig.ctms.web.chrome.Task" p:urlResolver-ref="urlResolver"
								  p:displayName="form.tab.manage_form" p:linkName="manageFormController"/>
                            <bean class="gov.nih.nci.cabig.ctms.web.chrome.Task" p:urlResolver-ref="urlResolver"
								  p:displayName="form.tab.create_form" p:linkName="createFormController"/>

                        </list>
                    </property>
                </bean>
                <bean class="gov.nih.nci.cabig.ctms.web.chrome.Section" p:urlResolver-ref="urlResolver"
					  p:displayName="Studies"
					  p:mainController="createStudyController" p:pathMapping="/study/**">
                    <property name="tasks">
                        <list>
                            <bean class="gov.nih.nci.cabig.ctms.web.chrome.Task" p:urlResolver-ref="urlResolver"
								  p:displayName="study.tab.enter_study" p:linkName="createStudyController"/>
                            <bean class="gov.nih.nci.cabig.ctms.web.chrome.Task" p:urlResolver-ref="urlResolver"
								  p:displayName="study.tab.search_study" p:linkName="searchStudyController"/>

                        </list>
                    </property>
                </bean>
                <bean class="gov.nih.nci.cabig.ctms.web.chrome.Section" p:urlResolver-ref="urlResolver"
					  p:displayName="Participants"
					  p:mainController="createParticipantController" p:pathMapping="/participant/**">
                    <property name="tasks">
                        <list>
                            <bean class="gov.nih.nci.cabig.ctms.web.chrome.Task" p:urlResolver-ref="urlResolver"
								  p:displayName="participant.tab.enter_participant"
								  p:linkName="createParticipantController"/>
                            <bean class="gov.nih.nci.cabig.ctms.web.chrome.Task" p:urlResolver-ref="urlResolver"
								  p:displayName="participant.tab.search_participant"
								  p:linkName="searchParticipantController"/>
                            <bean class="gov.nih.nci.cabig.ctms.web.chrome.Task" p:urlResolver-ref="urlResolver"
								  p:displayName="participant.tab.schedule_form" p:linkName="scheduleCrfController"/>
                        </list>
                    </property>
                </bean>
                <bean class="gov.nih.nci.cabig.ctms.web.chrome.Section" p:urlResolver-ref="urlResolver"
					  p:displayName="Administration"
					  p:mainController="createClinicalStaffController" p:pathMapping="/admin/**">
                    <property name="tasks">
                        <list>
                            <bean class="gov.nih.nci.cabig.ctms.web.chrome.Task" p:urlResolver-ref="urlResolver"
								  p:displayName="clinicalStaff.tab.clinical_staff"
								  p:linkName="createClinicalStaffController"/>
                        </list>
                    </property>
                </bean>


            </list>
        </property>
    </bean>

    <bean name="/form/manageForm" id="manageFormController" class="gov.nih.nci.ctcae.web.form.ManageFormController">
        <property name="finderRepository" ref="finderRepository"/>
    </bean>

    <bean name="/form/createForm" id="createFormController" class="gov.nih.nci.ctcae.web.form.CreateFormController"
		  parent="formController"/>

	<bean name="/form/editForm" id="editFormController" class="gov.nih.nci.ctcae.web.form.EditFormController"
		  parent="formController">
	</bean>

	<bean id="formController" class="gov.nih.nci.ctcae.web.form.FormController" abstract="true"
		  parent="tabbedFlowFormController">
        <property name="crfRepository" ref="crfRepository"/>
        <property name="uniqueTitleForCrfValidator" ref="uniqueTitleForCrfValidator"/>
        <property name="notEmptyValidator" ref="notEmptyValidator"/>
	</bean>


	<!--<bean name="/form/viewForm" id="viewFormController"-->
	<!--class="gov.nih.nci.ctcae.web.form.ConfirmFormController">-->
	<!--</bean>-->
	<!---->
	<bean name="/form/releaseForm" id="releaseFormController"
		  class="gov.nih.nci.ctcae.web.form.ReleaseFormController" parent="ctcaeSimpleFormController"
		  p:crfRepository-ref="crfRepository">
        <property name="finderRepository" ref="finderRepository"/>
        </bean>

    <bean name="/form/addOneCrfPageItem" id="addCrfPageItemController" parent="abstractCrfController"
		  class="gov.nih.nci.ctcae.web.form.AddCrfPageItemController">
    </bean>
    <bean name="/form/allConditions" id="allConditionsController"
		  class="gov.nih.nci.ctcae.web.form.AllConditionsController">
    </bean>
    <bean name="/form/addOneCrfPage" id="oneCrfPageController" parent="abstractCrfController"
		  class="gov.nih.nci.ctcae.web.form.AddOneCrfPageController">
    </bean>
    <bean name="abstractCrfController" id="crfController" abstract="true"
		  class="gov.nih.nci.ctcae.web.form.AbstractCrfController">
		<property name="finderRepository" ref="finderRepository"/>
		<property name="proCtcTermRepository" ref="proCtcTermRepository"/>
    </bean>
    <bean name="/form/addOneProCtcTerm" id="oneProCtcTermController" parent="abstractCrfController"
		  class="gov.nih.nci.ctcae.web.form.AddOneProCtcTermController">

    </bean>

    <bean name="/form/findCrfItem" id="findQuestionController"
		  class="gov.nih.nci.ctcae.web.form.FindCrfItemController">
        <property name="finderRepository" ref="finderRepository"/>
    </bean>
    <bean name="/form/setName" id="setNameController"
		  class="gov.nih.nci.ctcae.web.form.SetNameController">
    </bean>
    <bean name="/confirmationCheck" id="confirmationController"
		  class="gov.nih.nci.ctcae.web.ConfirmationCheckController">
    </bean>
    <bean name="/form/submit" id="submitFormController"
		  class="gov.nih.nci.ctcae.web.form.SubmitFormController" parent="ctcaeSimpleFormController">
        <property name="genericRepository" ref="genericRepository"/>
    </bean>

    <bean name="/form/addquestion" id="addQuestionByParticipantController"
		  class="gov.nih.nci.ctcae.web.form.AddQuestionByParticipantController" parent="ctcaeSimpleFormController">
        <property name="genericRepository" ref="genericRepository"/>
    </bean>
    <bean name="/form/addConditionalQuestion" id="addConditionalQuestionController"
		  class="gov.nih.nci.ctcae.web.form.AddConditionalQuestionController">
        <property name="finderRepository" ref="finderRepository"/>
    </bean>

	<bean name="/form/removeConditions" id="removeConditionsController"
		  class="gov.nih.nci.ctcae.web.form.RemoveConditionsController">
        <property name="finderRepository" ref="finderRepository"/>
    </bean>

    <bean name="/form/copyForm" id="copyFormController"
		  class="gov.nih.nci.ctcae.web.form.CopyFormController">
        <property name="finderRepository" ref="finderRepository"/>
        <property name="crfRepository" ref="crfRepository"/>

        </bean>
    <bean name="/form/deleteForm" id="deleteFormController"
		  class="gov.nih.nci.ctcae.web.form.DeleteFormController" parent="ctcaeSimpleFormController">
        <property name="finderRepository" ref="finderRepository"/>
        <property name="crfRepository" ref="crfRepository"/>

        </bean>
    <bean name="/form/versionForm" id="versionFormController"
		  class="gov.nih.nci.ctcae.web.form.VersionFormController" parent="ctcaeSimpleFormController">
        <property name="finderRepository" ref="finderRepository"/>
        <property name="crfRepository" ref="crfRepository"/>

        </bean>
    <bean name="/form/showVersionForm" id="showVersionFormController"
		  class="gov.nih.nci.ctcae.web.form.ShowVersionFormController">
        <property name="crfRepository" ref="crfRepository"/>

        </bean>


    <bean name="/study/createStudy" id="createStudyController"
		  class="gov.nih.nci.ctcae.web.study.CreateStudyController" parent="tabbedFlowFormController">
        <property name="studyRepository" ref="studyRepository"/>
    </bean>

    <bean name="/study/addStudySite" id="addStudySiteController"
		  class="gov.nih.nci.ctcae.web.study.AddStudySiteController">
    </bean>
    <bean name="/clinicalStaff/addSite" id="addSiteController"
		  class="gov.nih.nci.ctcae.web.clinicalStaff.AddSiteController">
    </bean>

    <bean name="/study/searchStudy" id="searchStudyController"
		  class="gov.nih.nci.ctcae.web.study.SearchStudyController">
    </bean>

    <bean name="/participant/create" id="createParticipantController"
		  class="gov.nih.nci.ctcae.web.participant.CreateParticipantController" parent="ctcaeSimpleFormController">
        <property name="participantRepository" ref="participantRepository"/>
        <property name="finderRepository" ref="finderRepository"/>
        <property name="organizationRepository" ref="organizationRepository"/>
    </bean>

    <bean name="/participant/edit" id="editParticipantController"
		  class="gov.nih.nci.ctcae.web.participant.EditParticipantController" parent="ctcaeSimpleFormController">
        <property name="participantRepository" ref="participantRepository"/>
        <property name="finderRepository" ref="finderRepository"/>
        <property name="organizationRepository" ref="organizationRepository"/>
    </bean>

    <bean name="/participant/search" id="searchParticipantController"
		  class="gov.nih.nci.ctcae.web.participant.SearchParticipantController">
    </bean>

    <bean name="/participant/schedulecrf" id="scheduleCrfController"
		  class="gov.nih.nci.ctcae.web.participant.ScheduleCrfController" parent="tabbedFlowFormController">
        <property name="studyParticipantAssignmentRepository" ref="studyParticipantAssignmentRepository"/>
    </bean>

    <bean name="/participant/participantInbox" id="participantInboxController"
		  class="gov.nih.nci.ctcae.web.participant.ParticipantInboxController" parent="ctcaeSimpleFormController">
        <property name="participantRepository" ref="participantRepository"/>
         </bean>

    <bean name="/participant/addCrfSchedule" id="addCrfScheduleController"
		  class="gov.nih.nci.ctcae.web.participant.AddCrfScheduleController">
        <property name="finderRepository" ref="finderRepository"/>
    </bean>

    <bean name="/admin/clinicalStaff/createClinicalStaff" id="createClinicalStaffController"
		  class="gov.nih.nci.ctcae.web.clinicalStaff.CreateClinicalStaffController" parent="ctcaeSimpleFormController">
        <property name="clinicalStaffRepository" ref="clinicalStaffRepository"/>
    </bean>
    <bean name="/admin/clinicalStaff/searchClinicalStaff" id="searchClinicalStaffController"
              class="gov.nih.nci.ctcae.web.clinicalStaff.SearchClinicalStaffController">
        </bean>

    <bean name="/reports/test" id="testReportController"
              class="gov.nih.nci.ctcae.web.reports.TestReportController">
    </bean>

	<!--<bean name="/researchStaff/createResearchStaff" id="createResearchStaffController"-->
	<!--class="gov.nih.nci.ctcae.web.researchStaff.CreateResearchStaffController" parent="ctcaeSimpleFormController">-->
	<!--<property name="researchStaffRepository" ref="researchStaffRepository"/>-->
	<!--</bean>-->


	<bean id="noCacheTemplate" abstract="true">
        <property name="cacheSeconds">
            <value>0</value>
        </property>
    </bean>


    <bean id="controllerTools" class="gov.nih.nci.ctcae.web.ControllerTools">
    </bean>


    <bean id="ctcaeSimpleFormController" class="gov.nih.nci.ctcae.web.CtcAeSimpleFormController"
		  p:finderRepository-ref="finderRepository" p:controllerTools-ref="controllerTools">
        <property name="webControllerValidator" ref="webControllerValidator"/>
    </bean>

    <bean id="tabConfigurer" class="gov.nih.nci.cabig.ctms.web.tabs.DefaultTabConfigurer"/>

    <bean name="tabbedFlowFormController" class="gov.nih.nci.ctcae.web.form.CtcAeTabbedFlowController" abstract="true">
        <property name="tabConfigurer" ref="tabConfigurer"/>
        <property name="studyRepository" ref="studyRepository"/>
        <property name="controllerTools" ref="controllerTools"/>
        <property name="finderRepository" ref="finderRepository"/>
        <property name="organizationRepository" ref="organizationRepository"/>
        <property name="webControllerValidator" ref="webControllerValidator"/>
    </bean>


	<!-- validation beans-->

	<bean id="webControllerValidator"
		  class="gov.nih.nci.ctcae.web.validation.validator.WebControllerValidatorImpl"/>

    <bean id="uniqueIdentifierForStudyValidator"
		  class="gov.nih.nci.ctcae.core.validation.annotation.UniqueIdentifierForStudyValidator">
        <property name="studyRepository" ref="studyRepository"/>
    </bean>
    <bean id="uniqueTitleForCrfValidator"
		  class="gov.nih.nci.ctcae.core.validation.annotation.UniqueTitleForCrfValidator">
        <property name="crfRepository" ref="crfRepository"/>
    </bean>

    <bean id="uniqueObjectInCollectionValidator"
		  class="gov.nih.nci.ctcae.core.validation.annotation.UniqueObjectInCollectionValidator">
    </bean>
    <bean id="notEmptyValidator"
		  class="gov.nih.nci.ctcae.core.validation.annotation.NotEmptyValidator">
    </bean>
    <bean id="notNullValidator"
		  class="gov.nih.nci.ctcae.core.validation.annotation.NotNullValidator">
    </bean>


</beans>
