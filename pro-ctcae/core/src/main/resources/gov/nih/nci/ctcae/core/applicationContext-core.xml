<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
      http://www.springframework.org/schema/beans/spring-beans.xsd
      http://www.springframework.org/schema/tx
      http://www.springframework.org/schema/tx/spring-tx.xsd">

    <!-- To tell Spring to look for @Transactional -->
    <tx:annotation-driven proxy-target-class="true"/>

    <!--  for @Repository annotation  -->
    <bean class="org.springframework.dao.annotation.PersistenceExceptionTranslationPostProcessor"/>

    <!--Following will make Spring container  act as a JPA container and inject an EnitityManager from your EntityManagerFactory.
         (for @PersistenceContext annotation)-->

    <bean class="org.springframework.orm.jpa.support.PersistenceAnnotationBeanPostProcessor"/>

    <!-- Transaction manager for a single DataSource (alternative to JTA). It is
         responsible for creating EntityManagers opening transactions and binding them to the current thread context. -->
    <!--  ============================================================================= -->
    <!-- Transaction manager for a single DataSource (alternative to JTA) -->
    <!--  ============================================================================= -->
    <bean id="transactionManager" class="org.springframework.orm.jpa.JpaTransactionManager">
        <property name="entityManagerFactory" ref="entityManagerFactory"/>
        <property name="dataSource" ref="dataSource"/>
    </bean>

    <!--  ========================================================================= -->
    <!-- JPA Persistence Manager Hibernate -->
    <!--  ========================================================================= -->

    <!-- This is the EntityManagerFactory configuration for Hibernate -->
    <bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
        <property name="dataSource" ref="dataSource"/>
        <property name="loadTimeWeaver">
            <bean class="org.springframework.instrument.classloading.InstrumentationLoadTimeWeaver"/>
        </property>
        <property name="jpaVendorAdapter">
            <bean class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter">
                <property name="database" value="POSTGRESQL"/>
                <property name="databasePlatform" value="org.hibernate.dialect.PostgreSQLDialect"/>
                <property name="showSql" value="true"/>
            </bean>
        </property>
    </bean>

    <!--  we may not need this interceptor -->

    <!--<bean id="entityManagerInterceptor" class="org.springframework.orm.jpa.support.OpenEntityManagerInViewInterceptor">-->
    <!--<property name="entityManagerFactory" ref="entityManagerFactory"/>-->
    <!--</bean>-->


    <bean id="genericRepository" class="gov.nih.nci.ctcae.core.repository.JpaGenericRepository"></bean>


    <!--<bean id="userRepository" class="gov.nih.nci.ctcae.core.repository.UserRepository">-->
    <!--<property name="genericRepository" ref="genericRepository"></property>-->
    <!--<property name="passwordEncoder" ref="passwordEncoder"></property>-->
    <!--<property name="saltSource" ref="saltSource"></property>-->

    <!--</bean>-->


    <bean id="commonRepository" class="gov.nih.nci.ctcae.core.repository.CommonRepository">
        <property name="genericRepository" ref="genericRepository"></property>
    </bean>
    <bean id="organizationRepository" class="gov.nih.nci.ctcae.core.repository.OrganizationRepository"
          parent="abstractRepository">
    </bean>
    <bean id="participantRepository" class="gov.nih.nci.ctcae.core.repository.ParticipantRepository"
          parent="abstractRepository">
    </bean>

    <bean id="studyRepository" class="gov.nih.nci.ctcae.core.repository.StudyRepository"
          parent="abstractRepository">
    </bean>
    <bean id="investigatorRepository" class="gov.nih.nci.ctcae.core.repository.InvestigatorRepository"
          parent="abstractRepository">
    </bean>

    <bean id="abstractRepository" class="gov.nih.nci.ctcae.core.repository.AbstractRepository" abstract="true">
        <property name="genericRepository" ref="genericRepository"></property>
    </bean>

    <bean id="crfRepository" class="gov.nih.nci.ctcae.core.repository.CRFRepository"
          parent="abstractRepository">
    </bean>

    <bean id="ctcTermRepository" class="gov.nih.nci.ctcae.core.repository.CtcTermRepository"
          parent="abstractRepository">
    </bean>

    <bean id="proCtcTermRepository" class="gov.nih.nci.ctcae.core.repository.ProCtcTermRepository"
          parent="abstractRepository">
    </bean>

    <bean id="proCtcRepository" class="gov.nih.nci.ctcae.core.repository.ProCtcRepository"
          parent="abstractRepository">
    </bean>

    <bean id="proCtcValidValueRepository" class="gov.nih.nci.ctcae.core.repository.ProCtcValidValueRepository"
          parent="abstractRepository">
    </bean>

    <bean id="crfItemRepository" class="gov.nih.nci.ctcae.core.repository.CrfItemRepository"
          parent="abstractRepository">
    </bean>
</beans>
